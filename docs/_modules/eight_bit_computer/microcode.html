

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>eight_bit_computer.microcode &mdash; Eight Bit Computer  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Eight Bit Computer
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/index.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../language/index.html">Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware/index.html">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/index.html">Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development_tools.html">Development Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../credits.html">Credits</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Eight Bit Computer</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>eight_bit_computer.microcode</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for eight_bit_computer.microcode</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">rom_programmer</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>

<div class="viewcode-block" id="gen_control_signal_dict"><a class="viewcode-back" href="../../software/source/eight_bit_computer.microcode.html#eight_bit_computer.microcode.gen_control_signal_dict">[docs]</a><span class="k">def</span> <span class="nf">gen_control_signal_dict</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate dictionary of control signal defitions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">control_signals</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;A_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;A_OUT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;B_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;B_OUT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OUT_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ALU_OUT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ALU_SUB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;RAM_ADDR_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;RAM_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;RAM_OUT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;REQUEST_USER_INPUT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;USER_INPUT_OUT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PROGRAM_COUNTER_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PROGRAM_COUNTER_OUT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PROGRAM_COUNTER_INCREMENT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;INSTRUCTION_REGISTER_IN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;STEP_COUNTER_RESET&quot;</span><span class="p">,</span>
        <span class="s2">&quot;HALT&quot;</span>
        <span class="p">]</span>

    <span class="c1"># Reversing so that the control signals will be in the same order</span>
    <span class="c1"># as specified here when looking from most significant to least</span>
    <span class="c1"># significant bit</span>
    <span class="n">control_signals</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="n">signal_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">control_signals</span><span class="p">):</span>
        <span class="n">signal_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">BitDef</span><span class="p">(</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">index</span><span class="p">,</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">index</span><span class="p">,</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">signal_dict</span></div>


<div class="viewcode-block" id="gen_opcode_addr_component_dict"><a class="viewcode-back" href="../../software/source/eight_bit_computer.microcode.html#eight_bit_computer.microcode.gen_opcode_addr_component_dict">[docs]</a><span class="k">def</span> <span class="nf">gen_opcode_addr_component_dict</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate dictionary of opcode address components</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">opcodes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;LDA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;STA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;JMPA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OUTA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;AADD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ASUB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;AUI&quot;</span><span class="p">,</span>

        <span class="s2">&quot;LDB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;STB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;JMPB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OUTB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BADD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BSUB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BUI&quot;</span><span class="p">,</span>

        <span class="s2">&quot;JIC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;JIUF&quot;</span><span class="p">,</span>
        <span class="s2">&quot;JMP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BUW&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NOOP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;HALT&quot;</span>
        <span class="p">]</span>

    <span class="n">component_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">opcodes</span><span class="p">):</span>
        <span class="n">component_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">BitDef</span><span class="p">(</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
            <span class="n">end</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">index</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">component_dict</span></div>


<div class="viewcode-block" id="gen_microcode_step_addr_component_dict"><a class="viewcode-back" href="../../software/source/eight_bit_computer.microcode.html#eight_bit_computer.microcode.gen_microcode_step_addr_component_dict">[docs]</a><span class="k">def</span> <span class="nf">gen_microcode_step_addr_component_dict</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a dictionary of microcode step address components</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">component_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">component_dict</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">BitDef</span><span class="p">(</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">end</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">index</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">component_dict</span></div>


<div class="viewcode-block" id="gen_input_signal_addr_component_dict"><a class="viewcode-back" href="../../software/source/eight_bit_computer.microcode.html#eight_bit_computer.microcode.gen_input_signal_addr_component_dict">[docs]</a><span class="k">def</span> <span class="nf">gen_input_signal_addr_component_dict</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create dictionary of input signal address components</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">input_signals</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;USER_INPUT_READY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CARRY&quot;</span>
        <span class="p">]</span>

    <span class="n">input_signals</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="n">component_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">input_signals</span><span class="p">):</span>
        <span class="n">component_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">BitDef</span><span class="p">(</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">index</span><span class="p">,</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">index</span><span class="p">,</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="p">)</span>
        <span class="n">not_name</span> <span class="o">=</span> <span class="s2">&quot;NOT_</span><span class="si">{name}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="n">component_dict</span><span class="p">[</span><span class="n">not_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">BitDef</span><span class="p">(</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">index</span><span class="p">,</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">index</span><span class="p">,</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="p">)</span>       

    <span class="k">return</span> <span class="n">component_dict</span></div>


<div class="viewcode-block" id="fetch"><a class="viewcode-back" href="../../software/source/eight_bit_computer.microcode.html#eight_bit_computer.microcode.fetch">[docs]</a><span class="k">def</span> <span class="nf">fetch</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">control_signal</span> <span class="o">=</span> <span class="n">gen_control_signal_dict</span><span class="p">()</span>
    <span class="n">mc_step_addr</span> <span class="o">=</span> <span class="n">gen_microcode_step_addr_component_dict</span><span class="p">()</span>
    <span class="n">opcode_addr</span> <span class="o">=</span> <span class="n">gen_opcode_addr_component_dict</span><span class="p">()</span>

    <span class="n">templates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">opcodes</span> <span class="o">=</span> <span class="n">opcode_addr</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

    <span class="c1"># opcodes = [</span>
    <span class="c1">#     opcode_addr[&quot;LDA&quot;],</span>
    <span class="c1">#     opcode_addr[&quot;LDB&quot;],</span>
    <span class="c1">#     opcode_addr[&quot;AADD&quot;],</span>
    <span class="c1">#     opcode_addr[&quot;OUTA&quot;],</span>
    <span class="c1">#     opcode_addr[&quot;HALT&quot;],</span>
    <span class="c1">#     opcode_addr[&quot;NOOP&quot;],</span>
    <span class="c1">#     opcode_addr[&quot;JIC&quot;]</span>
    <span class="c1"># ]</span>

    <span class="k">for</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="n">opcodes</span><span class="p">:</span>
        <span class="c1"># Step 0: PC -&gt; RAM Addr</span>
        <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
            <span class="n">opcode</span><span class="p">,</span>
            <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
            <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;PROGRAM_COUNTER_OUT&quot;</span><span class="p">],</span>
            <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;RAM_ADDR_IN&quot;</span><span class="p">]</span>
            <span class="p">])</span>

        <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

        <span class="c1"># Step 1: RAM -&gt; instruction register and program counter count</span>
        <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
            <span class="n">opcode</span><span class="p">,</span>
            <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
            <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;PROGRAM_COUNTER_INCREMENT&quot;</span><span class="p">],</span>
            <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;RAM_OUT&quot;</span><span class="p">],</span>
            <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;INSTRUCTION_REGISTER_IN&quot;</span><span class="p">]</span>
            <span class="p">])</span>

        <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">templates</span></div>


<div class="viewcode-block" id="LDA"><a class="viewcode-back" href="../../software/source/eight_bit_computer.microcode.html#eight_bit_computer.microcode.LDA">[docs]</a><span class="k">def</span> <span class="nf">LDA</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">control_signal</span> <span class="o">=</span> <span class="n">gen_control_signal_dict</span><span class="p">()</span>
    <span class="n">opcode_addr</span> <span class="o">=</span> <span class="n">gen_opcode_addr_component_dict</span><span class="p">()</span>
    <span class="n">mc_step_addr</span> <span class="o">=</span> <span class="n">gen_microcode_step_addr_component_dict</span><span class="p">()</span>

    <span class="n">templates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Step 2: PC -&gt; RAM Addr</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
        <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="n">opcode_addr</span><span class="p">[</span><span class="s2">&quot;LDA&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;PROGRAM_COUNTER_OUT&quot;</span><span class="p">],</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;RAM_ADDR_IN&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="c1"># Step 3: RAM -&gt; RAM Addr and PC Incr</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
        <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="n">opcode_addr</span><span class="p">[</span><span class="s2">&quot;LDA&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;RAM_OUT&quot;</span><span class="p">],</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;RAM_ADDR_IN&quot;</span><span class="p">],</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;PROGRAM_COUNTER_INCREMENT&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="c1"># Step 4: RAM -&gt; A and PC Incr</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
        <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
        <span class="n">opcode_addr</span><span class="p">[</span><span class="s2">&quot;LDA&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;RAM_OUT&quot;</span><span class="p">],</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;A_IN&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="c1"># Step 5: Reset microcode step counter</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
        <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
        <span class="n">opcode_addr</span><span class="p">[</span><span class="s2">&quot;LDA&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;STEP_COUNTER_RESET&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">templates</span></div>


<div class="viewcode-block" id="LDB"><a class="viewcode-back" href="../../software/source/eight_bit_computer.microcode.html#eight_bit_computer.microcode.LDB">[docs]</a><span class="k">def</span> <span class="nf">LDB</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">control_signal</span> <span class="o">=</span> <span class="n">gen_control_signal_dict</span><span class="p">()</span>
    <span class="n">opcode_addr</span> <span class="o">=</span> <span class="n">gen_opcode_addr_component_dict</span><span class="p">()</span>
    <span class="n">mc_step_addr</span> <span class="o">=</span> <span class="n">gen_microcode_step_addr_component_dict</span><span class="p">()</span>

    <span class="n">templates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Step 2: PC -&gt; RAM Addr</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
        <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="n">opcode_addr</span><span class="p">[</span><span class="s2">&quot;LDB&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;PROGRAM_COUNTER_OUT&quot;</span><span class="p">],</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;RAM_ADDR_IN&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="c1"># Step 3: RAM -&gt; RAM Addr and PC Incr</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
        <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="n">opcode_addr</span><span class="p">[</span><span class="s2">&quot;LDB&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;RAM_OUT&quot;</span><span class="p">],</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;RAM_ADDR_IN&quot;</span><span class="p">],</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;PROGRAM_COUNTER_INCREMENT&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="c1"># Step 3: RAM -&gt; B</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
        <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
        <span class="n">opcode_addr</span><span class="p">[</span><span class="s2">&quot;LDB&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;RAM_OUT&quot;</span><span class="p">],</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;B_IN&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="c1"># Step 5: Reset microcode step counter</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
        <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
        <span class="n">opcode_addr</span><span class="p">[</span><span class="s2">&quot;LDB&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;STEP_COUNTER_RESET&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">templates</span></div>


<div class="viewcode-block" id="AADD"><a class="viewcode-back" href="../../software/source/eight_bit_computer.microcode.html#eight_bit_computer.microcode.AADD">[docs]</a><span class="k">def</span> <span class="nf">AADD</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">control_signal</span> <span class="o">=</span> <span class="n">gen_control_signal_dict</span><span class="p">()</span>
    <span class="n">opcode_addr</span> <span class="o">=</span> <span class="n">gen_opcode_addr_component_dict</span><span class="p">()</span>
    <span class="n">mc_step_addr</span> <span class="o">=</span> <span class="n">gen_microcode_step_addr_component_dict</span><span class="p">()</span>

    <span class="n">templates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Step 2: ALU -&gt; A</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
        <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="n">opcode_addr</span><span class="p">[</span><span class="s2">&quot;AADD&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;ALU_OUT&quot;</span><span class="p">],</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;A_IN&quot;</span><span class="p">]</span>
        <span class="p">])</span>

    <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="c1"># Step 3: Reset microcode step</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
        <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="n">opcode_addr</span><span class="p">[</span><span class="s2">&quot;AADD&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;STEP_COUNTER_RESET&quot;</span><span class="p">]</span>
        <span class="p">])</span>

    <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">templates</span></div>


<div class="viewcode-block" id="OUTA"><a class="viewcode-back" href="../../software/source/eight_bit_computer.microcode.html#eight_bit_computer.microcode.OUTA">[docs]</a><span class="k">def</span> <span class="nf">OUTA</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The OUTA Operation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">control_signal</span> <span class="o">=</span> <span class="n">gen_control_signal_dict</span><span class="p">()</span>
    <span class="n">opcode_addr</span> <span class="o">=</span> <span class="n">gen_opcode_addr_component_dict</span><span class="p">()</span>
    <span class="n">mc_step_addr</span> <span class="o">=</span> <span class="n">gen_microcode_step_addr_component_dict</span><span class="p">()</span>
    <span class="n">input_sig_addr</span> <span class="o">=</span> <span class="n">gen_input_signal_addr_component_dict</span><span class="p">()</span>

    <span class="n">templates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Step 2 - A -&gt; OUT</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
        <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="n">opcode_addr</span><span class="p">[</span><span class="s2">&quot;OUTA&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;A_OUT&quot;</span><span class="p">],</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;OUT_IN&quot;</span><span class="p">]</span>
        <span class="p">])</span>

    <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="c1"># Step 3: Reset microcode step</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
        <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="n">opcode_addr</span><span class="p">[</span><span class="s2">&quot;OUTA&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;STEP_COUNTER_RESET&quot;</span><span class="p">]</span>
        <span class="p">])</span>

    <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">templates</span></div>


<div class="viewcode-block" id="HALT"><a class="viewcode-back" href="../../software/source/eight_bit_computer.microcode.html#eight_bit_computer.microcode.HALT">[docs]</a><span class="k">def</span> <span class="nf">HALT</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">control_signal</span> <span class="o">=</span> <span class="n">gen_control_signal_dict</span><span class="p">()</span>
    <span class="n">opcode_addr</span> <span class="o">=</span> <span class="n">gen_opcode_addr_component_dict</span><span class="p">()</span>
    <span class="n">mc_step_addr</span> <span class="o">=</span> <span class="n">gen_microcode_step_addr_component_dict</span><span class="p">()</span>

    <span class="n">templates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Step 2: Set halt flag</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
        <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="n">opcode_addr</span><span class="p">[</span><span class="s2">&quot;HALT&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;HALT&quot;</span><span class="p">]</span>
        <span class="p">])</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">)]</span></div>


<div class="viewcode-block" id="NOOP"><a class="viewcode-back" href="../../software/source/eight_bit_computer.microcode.html#eight_bit_computer.microcode.NOOP">[docs]</a><span class="k">def</span> <span class="nf">NOOP</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The NOOP Operation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">opcode_addr</span> <span class="o">=</span> <span class="n">gen_opcode_addr_component_dict</span><span class="p">()</span>
    <span class="n">mc_step_addr</span> <span class="o">=</span> <span class="n">gen_microcode_step_addr_component_dict</span><span class="p">()</span>
    <span class="n">control_signal</span> <span class="o">=</span> <span class="n">gen_control_signal_dict</span><span class="p">()</span>


    <span class="c1"># Step 2: Reset microcode step</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
        <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="n">opcode_addr</span><span class="p">[</span><span class="s2">&quot;NOOP&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;STEP_COUNTER_RESET&quot;</span><span class="p">]</span>
        <span class="p">])</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">)]</span></div>


<div class="viewcode-block" id="JIC"><a class="viewcode-back" href="../../software/source/eight_bit_computer.microcode.html#eight_bit_computer.microcode.JIC">[docs]</a><span class="k">def</span> <span class="nf">JIC</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">control_signal</span> <span class="o">=</span> <span class="n">gen_control_signal_dict</span><span class="p">()</span>
    <span class="n">opcode_addr</span> <span class="o">=</span> <span class="n">gen_opcode_addr_component_dict</span><span class="p">()</span>
    <span class="n">mc_step_addr</span> <span class="o">=</span> <span class="n">gen_microcode_step_addr_component_dict</span><span class="p">()</span>
    <span class="n">input_signals</span> <span class="o">=</span> <span class="n">gen_input_signal_addr_component_dict</span><span class="p">()</span>

    <span class="n">templates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">############</span>
    <span class="c1"># IF CARRY #</span>
    <span class="c1">############</span>
    <span class="c1"># Step 2: PC -&gt; RAM Addr</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
        <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="n">opcode_addr</span><span class="p">[</span><span class="s2">&quot;JIC&quot;</span><span class="p">],</span>
        <span class="n">input_signals</span><span class="p">[</span><span class="s2">&quot;CARRY&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;PROGRAM_COUNTER_OUT&quot;</span><span class="p">],</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;RAM_ADDR_IN&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="c1"># Step 3: RAM -&gt; PC</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
        <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="n">opcode_addr</span><span class="p">[</span><span class="s2">&quot;JIC&quot;</span><span class="p">],</span>
        <span class="n">input_signals</span><span class="p">[</span><span class="s2">&quot;CARRY&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;RAM_OUT&quot;</span><span class="p">],</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;PROGRAM_COUNTER_IN&quot;</span><span class="p">],</span>
        <span class="p">])</span>
    <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="c1"># Step 4: Reset microcode step counter</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
        <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
        <span class="n">opcode_addr</span><span class="p">[</span><span class="s2">&quot;JIC&quot;</span><span class="p">],</span>
        <span class="n">input_signals</span><span class="p">[</span><span class="s2">&quot;CARRY&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;STEP_COUNTER_RESET&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="c1">################</span>
    <span class="c1"># IF NOT CARRY #</span>
    <span class="c1">################</span>
    <span class="c1"># Step 2: PC increment (Skip past the address we would have jumped </span>
    <span class="c1"># to)</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
        <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="n">opcode_addr</span><span class="p">[</span><span class="s2">&quot;JIC&quot;</span><span class="p">],</span>
        <span class="n">input_signals</span><span class="p">[</span><span class="s2">&quot;NOT_CARRY&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;PROGRAM_COUNTER_INCREMENT&quot;</span><span class="p">],</span>
        <span class="p">])</span>
    <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="c1"># Step 3: Reset microcode step counter</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_address_components</span><span class="p">([</span>
        <span class="n">mc_step_addr</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="n">opcode_addr</span><span class="p">[</span><span class="s2">&quot;JIC&quot;</span><span class="p">],</span>
        <span class="n">input_signals</span><span class="p">[</span><span class="s2">&quot;NOT_CARRY&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">combine_data_components</span><span class="p">([</span>
        <span class="n">control_signal</span><span class="p">[</span><span class="s2">&quot;STEP_COUNTER_RESET&quot;</span><span class="p">]</span>
        <span class="p">])</span>
    <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">DataTemplate</span><span class="p">(</span><span class="n">addresses</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">templates</span></div>


<div class="viewcode-block" id="create_microcode_rom"><a class="viewcode-back" href="../../software/source/eight_bit_computer.microcode.html#eight_bit_computer.microcode.create_microcode_rom">[docs]</a><span class="k">def</span> <span class="nf">create_microcode_rom</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data_templates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">data_templates</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">fetch</span><span class="p">())</span>
    <span class="n">data_templates</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">LDA</span><span class="p">())</span>
    <span class="n">data_templates</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">LDB</span><span class="p">())</span>
    <span class="n">data_templates</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">AADD</span><span class="p">())</span>
    <span class="n">data_templates</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">OUTA</span><span class="p">())</span>    
    <span class="n">data_templates</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">HALT</span><span class="p">())</span>
    <span class="n">data_templates</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">NOOP</span><span class="p">())</span>
    <span class="n">data_templates</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">JIC</span><span class="p">())</span>


    <span class="n">rom_dict</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">data_templates_to_dict</span><span class="p">(</span><span class="n">data_templates</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">rom_dict</span></div>


<div class="viewcode-block" id="print_microcode_rom"><a class="viewcode-back" href="../../software/source/eight_bit_computer.microcode.html#eight_bit_computer.microcode.print_microcode_rom">[docs]</a><span class="k">def</span> <span class="nf">print_microcode_rom</span><span class="p">(</span><span class="n">rom</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">address_width</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">bit_width</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">rom</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">data_width</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">bit_width</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">rom</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

    <span class="n">opcode_components</span> <span class="o">=</span> <span class="n">gen_opcode_addr_component_dict</span><span class="p">()</span>
    <span class="n">step_components</span> <span class="o">=</span> <span class="n">gen_microcode_step_addr_component_dict</span><span class="p">()</span>
    <span class="n">input_signal_components</span> <span class="o">=</span> <span class="n">gen_input_signal_addr_component_dict</span><span class="p">()</span>
    <span class="n">control_signal_components</span> <span class="o">=</span> <span class="n">gen_control_signal_dict</span><span class="p">()</span>

    <span class="n">address_reports</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">address_report_template</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Address: </span><span class="si">{address_string}</span><span class="se">\n</span><span class="s2">Address: </span><span class="si">{addr_info_string}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Data: </span><span class="si">{data_string}</span><span class="se">\n</span><span class="s2">Data: </span><span class="si">{data_info_string}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">address</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rom</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">address_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{binary_address:}</span><span class="s2"> (</span><span class="si">{address}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">binary_address</span><span class="o">=</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">value_to_binary_string</span><span class="p">(</span>
                <span class="n">address</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">address_width</span><span class="p">),</span>
            <span class="n">address</span><span class="o">=</span><span class="n">address</span>
            <span class="p">)</span>

        <span class="n">address_info</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">decompose_address</span><span class="p">(</span>
            <span class="n">address</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;opcode&quot;</span><span class="p">:</span><span class="n">opcode_components</span><span class="p">,</span>
                <span class="s2">&quot;step&quot;</span><span class="p">:</span><span class="n">step_components</span><span class="p">,</span>
                <span class="s2">&quot;input_signals&quot;</span><span class="p">:</span><span class="n">input_signal_components</span>
            <span class="p">})</span>

        <span class="n">addr_info_string</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;opcode: </span><span class="si">{opcode:&lt;7}</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;step: </span><span class="si">{step:&lt;7}</span><span class="s2"> input signal(s): </span><span class="si">{input_signals}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">opcode</span><span class="o">=</span><span class="n">address_info</span><span class="p">[</span><span class="s2">&quot;opcode&quot;</span><span class="p">],</span>
                <span class="n">step</span><span class="o">=</span><span class="n">address_info</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">],</span>
                <span class="n">input_signals</span><span class="o">=</span><span class="n">address_info</span><span class="p">[</span><span class="s2">&quot;input_signals&quot;</span><span class="p">]</span>
            <span class="p">))</span>

        <span class="n">data_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{binary_data}</span><span class="s2"> (</span><span class="si">{data}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">binary_data</span><span class="o">=</span><span class="n">rom_programmer</span><span class="o">.</span><span class="n">value_to_binary_string</span><span class="p">(</span>
                <span class="n">rom</span><span class="p">[</span><span class="n">address</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">data_width</span>
                <span class="p">),</span>
            <span class="n">data</span><span class="o">=</span><span class="n">rom</span><span class="p">[</span><span class="n">address</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="n">data_info</span> <span class="o">=</span> <span class="n">rom_programmer</span><span class="o">.</span><span class="n">extract_bitdefs</span><span class="p">(</span>
            <span class="n">rom</span><span class="p">[</span><span class="n">address</span><span class="p">],</span>
            <span class="n">control_signal_components</span>
            <span class="p">)</span>

        <span class="n">data_info_string</span> <span class="o">=</span> <span class="s2">&quot;control singal(s): </span><span class="si">{control_signals}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">control_signals</span><span class="o">=</span><span class="n">data_info</span>
            <span class="p">)</span>

        <span class="n">address_reports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">address_report_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">address_string</span><span class="o">=</span><span class="n">address_string</span><span class="p">,</span>
            <span class="n">addr_info_string</span><span class="o">=</span><span class="n">addr_info_string</span><span class="p">,</span>
            <span class="n">data_string</span><span class="o">=</span><span class="n">data_string</span><span class="p">,</span>
            <span class="n">data_info_string</span><span class="o">=</span><span class="n">data_info_string</span>
            <span class="p">))</span>

    <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=========================================</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">address_reports</span><span class="p">)</span></div>


<span class="c1"># def OPCODE(address_width):</span>
<span class="c1">#     &quot;&quot;&quot;</span>

<span class="c1">#     &quot;&quot;&quot;</span>

<span class="c1">#     control_signal = gen_control_signal_dict()</span>
<span class="c1">#     opcode_addr = gen_opcode_addr_component_dict()</span>
<span class="c1">#     mc_step_addr = gen_microcode_step_addr_component_dict()</span>
<span class="c1">#     input_sig_addr = gen_input_signal_addr_component_dict()</span>

<span class="c1">#     templates = []</span>

<span class="c1">#     # Step 2</span>
<span class="c1">#     addresses = combine_address_components(</span>
<span class="c1">#         address_width,</span>
<span class="c1">#         mc_step_addr[2],</span>
<span class="c1">#         opcode_addr[ ]</span>
<span class="c1">#         )</span>
<span class="c1">#     data = (</span>
<span class="c1">#         control_signal[&quot;&quot;]</span>
<span class="c1">#         )</span>

<span class="c1">#     templates.append(DataTemplate(addresses, data))</span>

<span class="c1">#     # Step N - 1: Reset microcode step</span>
<span class="c1">#     addresses = combine_address_components(</span>
<span class="c1">#         address_width,</span>
<span class="c1">#         mc_step_addr[ ],</span>
<span class="c1">#         opcode_addr[ ]</span>
<span class="c1">#         )</span>
<span class="c1">#     data = (</span>
<span class="c1">#         control_signal[&quot;STEP_COUNTER_RESET&quot;]</span>
<span class="c1">#         )</span>

<span class="c1">#     templates.append(DataTemplate(addresses, data))</span>

<span class="c1">#     return templates</span>

<span class="c1"># mc_steps = gen_microcode_step_addr_component_dict()</span>
<span class="c1"># pprint(mc_steps)</span>

<span class="c1"># pprint(fetch())</span>
<span class="c1"># pprint(LDA())</span>
<span class="c1"># pprint(LDB())</span>
<span class="c1"># pprint(AADD())</span>
<span class="c1"># pprint(OUTA())    </span>
<span class="c1"># pprint(HALT())</span>
<span class="c1"># pprint(NOOP())</span>

<span class="c1"># rom = create_microcode_rom()</span>
<span class="c1"># print len(rom)</span>
<span class="c1"># pprint(rom)</span>
<span class="c1"># # print_microcode_rom(rom)</span>

<span class="c1"># rom_programmer.rom_to_logisim(</span>
<span class="c1">#     rom, </span>
<span class="c1">#     directory=&quot;/Users/andy/Documents/74_series_computer/logisim_roms&quot;,</span>
<span class="c1">#     filename_base=&quot;microcode&quot;,</span>
<span class="c1">#     bytes_per_line=16)</span>
<span class="c1"># rom_programmer.rom_to_arduino(rom)</span>


<span class="c1"># steps = gen_microcode_step_addr_component_dict()</span>
<span class="c1"># pprint(steps)</span>

<span class="c1"># print steps[0]</span>

<span class="c1"># step0 = combine_address_components([steps[0]])</span>
<span class="c1"># print step0</span>




<span class="c1"># control_sigs = gen_control_signal_dict()</span>
<span class="c1"># pprint(control_sigs)</span>

<span class="c1"># fetch_def = fetch()</span>
<span class="c1"># print fetch_def</span>

<span class="c1"># print get_value_from_bit_range(528, 4, 4)</span>


<span class="c1"># print rom_programmer.extract_bitdefs(0, gen_control_signal_dict())</span>
<span class="c1"># print rom_programmer.extract_bitdefs(1, gen_control_signal_dict())</span>
<span class="c1"># print rom_programmer.extract_bitdefs(2, gen_control_signal_dict())</span>
<span class="c1"># print rom_programmer.extract_bitdefs(4, gen_control_signal_dict())</span>
<span class="c1"># print rom_programmer.extract_bitdefs(8, gen_control_signal_dict())</span>
<span class="c1"># print rom_programmer.extract_bitdefs(16, gen_control_signal_dict())</span>
<span class="c1"># print rom_programmer.extract_bitdefs(2**16, gen_control_signal_dict())</span>




<span class="c1"># pprint(gen_control_signal_dict())</span>

<span class="c1"># first = BitDef(0,0,0)</span>
<span class="c1"># second = BitDef(1,3,7)</span>
<span class="c1"># bad = BitDef(2,2,0)</span>

<span class="c1"># print first.start</span>

<span class="c1"># print combine_address_components(5, second, first)</span>
<span class="c1"># print combine_address_components(5, first, second)</span>
<span class="c1"># print combine_address_components(5, first)</span>
<span class="c1"># print combine_address_components(5, second)</span>
<span class="c1"># print combine_address_components(5, first, bad)</span>
<span class="c1"># print combine_address_components(5, first, second, bad)</span>

<span class="c1"># pprint(fetch(11))</span>
<span class="c1"># LDA = data_templates_to_dict(LDA(10))</span>
<span class="c1"># pprint(LDA)</span>
<span class="c1"># rom_info(LDA)</span>
<span class="c1"># rom_to_logisim(LDA)</span>
<span class="c1"># rom = create_microcode_rom()</span>



<span class="c1"># aadd, step 3 and no signal</span>
<span class="c1"># pprint(decompose_address(&quot;0010000000&quot;))</span>
<span class="c1"># pprint(decompose_data(4224))</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">An address but some bits need to be expanded to all thier combinations</span>
<span class="sd">e.g. 11010XX00100</span>
<span class="sd">address template</span>
<span class="sd">address range</span>
<span class="sd">address combo</span>
<span class="sd">address seed</span>
<span class="sd">address base</span>
<span class="sd">address blueprint</span>
<span class="sd">address breakdown</span>
<span class="sd">address group</span>
<span class="sd">address collection</span>
<span class="sd">compressed address</span>
<span class="sd">folded address</span>
<span class="sd">stacked address</span>


<span class="sd">The addresses to be expanded have this data:</span>
<span class="sd">data canvas</span>
<span class="sd">data blanket</span>
<span class="sd">data range</span>
<span class="sd">data cover</span>
<span class="sd">data group</span>
<span class="sd">data set</span>
<span class="sd">data collection</span>
<span class="sd">rom section</span>
<span class="sd">rom slice</span>
<span class="sd">rom fill(er)</span>
<span class="sd">storage</span>
<span class="sd">data template</span>
<span class="sd">data plan</span>



<span class="sd">This part of the address has this value</span>
<span class="sd">addressComponent</span>
<span class="sd">bitDef</span>

<span class="sd">Opcode planning</span>
<span class="sd">LOAD A</span>
<span class="sd">STORE A</span>
<span class="sd">JUMP IF A == 0</span>
<span class="sd">OUTPUT A</span>
<span class="sd">A = A + B</span>
<span class="sd">A = A - B</span>
<span class="sd">A = USER_INPUT</span>

<span class="sd">LOAD B</span>
<span class="sd">STORE B</span>
<span class="sd">JUMP IF B == 0</span>
<span class="sd">OUTPUT B</span>
<span class="sd">B = A + B</span>
<span class="sd">B = A - B</span>
<span class="sd">B = USER_INPUT</span>

<span class="sd">JUMP IF CARRY ADD</span>
<span class="sd">JUMP IF CARRY SUB</span>
<span class="sd">JUMP IF USER FINISHED</span>
<span class="sd">JUMP</span>
<span class="sd">BEGIN USER WAIT</span>
<span class="sd">NOOP</span>
<span class="sd">HALT</span>

<span class="sd">-----</span>

<span class="sd">LOAD A</span>
<span class="sd">SAVE A</span>
<span class="sd">JUMP IF A == 0</span>
<span class="sd">JUMP TO ADDRESS IN A</span>
<span class="sd">JUMP TO ADDRESS IN A IF CARRY ADD</span>
<span class="sd">JUMP TO ADDRESS IN A IF CARRY SUB</span>
<span class="sd">JUMP TO ADDRESS IN A IF USER FINISHED</span>
<span class="sd">OUTPUT A</span>
<span class="sd">A = A + B</span>
<span class="sd">A = A - B</span>
<span class="sd">A = USER_INPUT</span>

<span class="sd">LOAD B</span>
<span class="sd">SAVE B</span>
<span class="sd">JUMP IF B == 0</span>
<span class="sd">JUMP TO ADDRESS IN B</span>
<span class="sd">JUMP TO ADDRESS IN B IF CARRY ADD</span>
<span class="sd">JUMP TO ADDRESS IN B IF CARRY SUB</span>
<span class="sd">JUMP TO ADDRESS IN B IF USER FINISHED</span>
<span class="sd">OUTPUT B</span>
<span class="sd">B = A + B</span>
<span class="sd">B = A - B</span>
<span class="sd">B = USER_INPUT</span>

<span class="sd">JUMP TO ADDRESS IN Y IF Z == 0</span>
<span class="sd">LOAD Y FROM ADDRESS IN Z</span>
<span class="sd">STORE Y TO ADDRESS IN Z</span>
<span class="sd">MOVE Y TO Z</span>

<span class="sd">JUMP IF CARRY ADD</span>
<span class="sd">JUMP IF CARRY SUB</span>
<span class="sd">JUMP IF USER FINISHED</span>
<span class="sd">JUMP</span>
<span class="sd">BEGIN USER WAIT</span>
<span class="sd">NOOP</span>
<span class="sd">HALT</span>

<span class="sd">----</span>


<span class="sd">Memory mapped and proper ALU planning</span>


<span class="sd">Opcodes</span>
<span class="sd">-------</span>
<span class="sd">LDMX</span>
<span class="sd">LDIX</span>
<span class="sd">STOX</span>
<span class="sd">ADDX</span>
<span class="sd">SUBX</span>
<span class="sd">ANDX</span>
<span class="sd">ORX</span>
<span class="sd">NOTX</span>
<span class="sd">XORX</span>
<span class="sd">BSLX</span>
<span class="sd">BSRX</span>
<span class="sd">JMPX</span>
<span class="sd">PCX</span>

<span class="sd">JMP</span>
<span class="sd">JMPIC</span>
<span class="sd">JMPIBSL</span>
<span class="sd">JMPIBSR</span>
<span class="sd">JMPZ</span>
<span class="sd">NOOP</span>
<span class="sd">HALT</span>

<span class="sd">MOVXY (12)</span>

<span class="sd">0XXXXXXX - Register speciific instructions</span>
<span class="sd">000XXXXX - Register A speciific instructions</span>
<span class="sd">001XXXXX - Register B speciific instructions</span>
<span class="sd">010XXXXX - Register C speciific instructions</span>
<span class="sd">011XXXXX - Register D speciific instructions</span>

<span class="sd">11XXXXXX - General instructions</span>

<span class="sd">10XXXXXX - Move instructions</span>
<span class="sd">1000YYZZ - Move YY to ZZ</span>



<span class="sd">Control Sigs</span>
<span class="sd">------------</span>
<span class="sd">A_IN</span>
<span class="sd">A_OUT</span>
<span class="sd">B_IN</span>
<span class="sd">B_OUT</span>
<span class="sd">C_IN</span>
<span class="sd">C_OUT</span>
<span class="sd">D_IN</span>
<span class="sd">D_OUT</span>

<span class="sd">ALU_OUT</span>
<span class="sd">ALUOP_0</span>
<span class="sd">ALUOP_1</span>
<span class="sd">ALUOP_2</span>
<span class="sd">ZERO_CHECK_ENABLE</span>
<span class="sd">RAM_ADDR_IN</span>
<span class="sd">RAM_IN</span>
<span class="sd">RAM_OUT</span>

<span class="sd">PROGRAM_COUNTER_IN</span>
<span class="sd">PROGRAM_COUNTER_OUT</span>
<span class="sd">PROGRAM_COUNTER_INCREMENT</span>
<span class="sd">INSTRUCTION_REGISTER_IN</span>
<span class="sd">HALT</span>
<span class="sd">STEP_COUNTER_RESET</span>

<span class="sd">Input sigs</span>
<span class="sd">----------</span>
<span class="sd">IS_ZERO</span>
<span class="sd">OVERFLOW</span>





















<span class="sd">############################################################</span>
<span class="sd">Using 74LS181 for ALU, stack pointer and Havard architecture</span>
<span class="sd">############################################################</span>





<span class="sd">Op codes</span>
<span class="sd">COPY - SRC:[A, B, C, D, PC, SP], DEST:[A, B, C, D, PC, SP]</span>
<span class="sd">    Copies SRC to DEST</span>
<span class="sd">ADD - REG:[A, B, C, D, PC, SP]</span>
<span class="sd">    Adds REG to B and stores the result in REG</span>
<span class="sd">ADD_CARRY - REG:[A, B, C, D, PC, SP]</span>
<span class="sd">    Adds REG to B, adding 1 if the last add had a carry and stores the result in REG</span>
<span class="sd">SUB - REG:[A, B, C, D, PC, SP]</span>
<span class="sd">    Subtracts B from REG and stores the result in REG</span>
<span class="sd">SUB_BORROW - REG:[A, B, C, D, PC, SP]</span>
<span class="sd">    Subtracts B from REG, sutracting 1 if the last subtracton had a borrow, stores the result in REG</span>
<span class="sd">LOAD - SRC:[A, B, C, D, PC, SP], DEST:[A, B, C, D, PC, SP]</span>
<span class="sd">    Copies the value in memory at the location in SRC to DEST</span>
<span class="sd">LOAD_IMMEDIATE - CONSTANT, DEST:[A, B, C, D, PC, SP]</span>
<span class="sd">    Sets DEST to CONSTANT</span>
<span class="sd">STORE - SRC:[A, B, C, D, PC, SP] DEST:[A, B, C, D, PC, SP]</span>
<span class="sd">    Copies the value in the register SRC into memory at the location in DEST</span>
<span class="sd">STORE_IMMEDIATE - CONSTANT, DEST:[A, B, C, D, PC, SP]</span>
<span class="sd">    Sets the memory at the location in DEST to CONSTANT</span>



<span class="sd">PUSH - DEST:[A, B, C, D]</span>
<span class="sd">    Copy the value in DEST to memory at the location in SP and then decrement SP by 1</span>
<span class="sd">POP - DEST:[A, B, C, D]</span>
<span class="sd">    Increment SP by 1 and copy the value in memory at the location in SP to DEST</span>
<span class="sd">AND</span>

<span class="sd">OR</span>

<span class="sd">NOT</span>

<span class="sd">XOR</span>

<span class="sd">HALT</span>

<span class="sd">JUMP</span>

<span class="sd">INCR</span>

<span class="sd">DECR</span>

<span class="sd">CALL</span>

<span class="sd">RET</span>

<span class="sd">JUMP</span>

<span class="sd">JUMP_IF_ZERO</span>

<span class="sd">JUMP_IF_EQUAL</span>

<span class="sd">JUMP_IF_LESS_THAN</span>

<span class="sd">JUMP_IF_LESS_THAN_OR_EQUAL</span>

<span class="sd">JUMP_IF_GREATER_THAN</span>

<span class="sd">JUMP_IF_GREATER_THAN_OR_EQUAL</span>

<span class="sd">JUMP_IF_CARRY</span>

<span class="sd">JUMP_IF_BORROW</span>




<span class="sd">Input Sigs</span>
<span class="sd">----------</span>
<span class="sd">Opcode (8 bits)</span>
<span class="sd">Microcode Step (3 bits)</span>
<span class="sd">ALU ZERO</span>
<span class="sd">ALU CARRY/COMPARE</span>
<span class="sd">ALU EQUALITY</span>

<span class="sd">Control Sigs</span>
<span class="sd">------------</span>
<span class="sd">A_IN</span>
<span class="sd">A_OUT</span>
<span class="sd">B_IN</span>
<span class="sd">B_OUT</span>
<span class="sd">C_IN</span>
<span class="sd">C_OUT</span>
<span class="sd">D_IN</span>
<span class="sd">D_OUT</span>

<span class="sd">ALU_IN</span>
<span class="sd">ALU_OUT</span>
<span class="sd">ALU_S0</span>
<span class="sd">ALU_S1</span>
<span class="sd">ALU_S2</span>
<span class="sd">ALU_S3</span>
<span class="sd">ALU_CIN</span>
<span class="sd">ALU_M</span>

<span class="sd">RAM_ADDR_IN</span>
<span class="sd">RAM_IN</span>
<span class="sd">RAM_OUT</span>
<span class="sd">PROGRAM_COUNTER_IN</span>
<span class="sd">PROGRAM_COUNTER_OUT</span>
<span class="sd">PROGRAM_COUNTER_COUNT</span>
<span class="sd">SP_IN</span>
<span class="sd">SP_OUT</span>

<span class="sd">INSTRUCTION_REGISTER_IN</span>
<span class="sd">PROGRAM_MEMORY_SELECT</span>
<span class="sd">STEP_COUNTER_RESET</span>
<span class="sd">HALT</span>
















<span class="sd">#########################</span>
<span class="sd">Op Codes from James Bates</span>
<span class="sd">#########################</span>

<span class="sd">00 DDD SSS - Copy instructions - Copy SSS to DDD</span>
<span class="sd">01 DDD [SSS] - Load instructions - Load memory contents at SSS into DDD</span>
<span class="sd">10 [DDD] SSS - Store instructions - Store SSS into memory at DDD</span>
<span class="sd">11 WWWW ZZ - ALU instructions - Do WWWW using ZZ (and sometimes B), and store the result in ZZ</span>
<span class="sd">00 110 CCC - Jump to an immediate value based on the result of the last test using the ALU (Pushes, Pops, Calls, Returns and other ALU operations will clobber the test results (Unless I AND bits 3, 4 and 5 (index starting at the right) of the op code and the alu write signal to enable a write to the flags register. But that will mean checking of other routine operations won&#39;t be possible))</span>
<span class="sd">00 111 CCC - Jump to an immediate value based on a test and check CCC between A and B register</span>

<span class="sd">Copy, Load and Store</span>
<span class="sd">====================</span>
<span class="sd">SSS = Source</span>
<span class="sd">DDD = Destination</span>
<span class="sd">WWWW = Operation</span>
<span class="sd">ZZ = Source/Dest</span>

<span class="sd">SSS/DDD - Source / Destination</span>
<span class="sd">000 = A</span>
<span class="sd">001 = B</span>
<span class="sd">010 = C</span>
<span class="sd">011 = D</span>
<span class="sd">100 = SP</span>
<span class="sd">101 = PC</span>
<span class="sd">110 = SP+/-</span>
<span class="sd">111 = Immediate</span>

<span class="sd">ALU</span>
<span class="sd">===</span>
<span class="sd">ZZ - Source / Destination</span>
<span class="sd">00 = A</span>
<span class="sd">01 = B</span>
<span class="sd">10 = C</span>
<span class="sd">11 = D</span>

<span class="sd">WWWW - ALU Operation</span>
<span class="sd">0000: ZZ = 0 </span>
<span class="sd">0001: ZZ = ZZ + 1</span>
<span class="sd">0010: ZZ = ZZ - 1</span>
<span class="sd">0011: ZZ = A + B</span>
<span class="sd">0100: ZZ = A - B</span>
<span class="sd">0101: ZZ = A + B with carry</span>
<span class="sd">0110: ZZ = A - B with borrow</span>
<span class="sd">0111: ZZ = A AND B</span>
<span class="sd">1000: ZZ = A OR B </span>
<span class="sd">1001: ZZ = A NAND B</span>
<span class="sd">1010: ZZ = A XOR B </span>
<span class="sd">1011: ZZ = NOT A </span>
<span class="sd">1100: ZZ = A &lt; 1</span>
<span class="sd">1101: ZZ = A &lt; 1 with carry </span>
<span class="sd">1110: Test ZZ and B (Greater than or equal to or less than and all other non size comparison tests) </span>
<span class="sd">1111: Test ZZ and B (Less than or equal to or greater than and all other non size comparison tests)</span>

<span class="sd">Checks</span>
<span class="sd">======</span>
<span class="sd">000: Check for equality to zero of the first value or last operation</span>
<span class="sd">001: Check for equality between the two values</span>
<span class="sd">010: Check if an addition resulted in a carry </span>
<span class="sd">011: Check if subtraction resulted in a borrow </span>
<span class="sd">100: Check if the first value is greater than the second value  </span>
<span class="sd">101: Check if the first value is greater than or equal to the second value </span>
<span class="sd">110: Check if the first value is less than the second value</span>
<span class="sd">111: Check if the first value is less than or equal to the second value</span>

<span class="sd">Op Codes</span>
<span class="sd">========</span>
<span class="sd">COPY - Copy SSS into DDD</span>
<span class="sd">    00 DDD SSS</span>
<span class="sd">LOAD - Copy the value in memory at SSS to DDD</span>
<span class="sd">    01 DDD [SSS]</span>
<span class="sd">STORE - Copy the value in SSS to memory at DDD</span>
<span class="sd">    10 [DDD] SSS</span>
<span class="sd">POP - Decrement SP and copy the memory at SP into DDD</span>
<span class="sd">    Actually a load with the source set to [SP+/-]</span>
<span class="sd">    01 DDD 110</span>
<span class="sd">PUSH - Copy DDD into memory at SP and increment SP</span>
<span class="sd">    Actually a store with the destination set to [SP+/-]</span>
<span class="sd">    10 110 DDD</span>
<span class="sd">DATA - Set a DDD to a specific value</span>
<span class="sd">    Actually a copy from an immediate value to DDD</span>
<span class="sd">    00 DDD 111</span>
<span class="sd">JUMP - Set the program counter to a value. JJJ has the same meaning as SSS/DDD</span>
<span class="sd">    Actually a copy where the desination is PC</span>
<span class="sd">    00 101 JJJ</span>
<span class="sd">CONDITIONAL_JUMP - Conditionally jump to an immediate value based on a check (CCC) of the result of the last test using the ALU</span>
<span class="sd">    Uses the unused move instruction with the destination as SP+/-</span>
<span class="sd">    00 110 CCC</span>
<span class="sd">TEST_AND_CONDITONAL_JUMP - Conditionally jump to an immediate value based on a check (CCC) of a test between A and B register</span>
<span class="sd">    Uses the unused move instruction with the destination as Immediate</span>
<span class="sd">    00 111 CCC</span>
<span class="sd">ALU - Perform the WWWW operation with the ALU where ZZ is a source, destination or both</span>
<span class="sd">    11 WWWW ZZ</span>
<span class="sd">CALL - Push the program counter, then set the program counter to a value. LLL has the same meaning as SSS/DDD</span>
<span class="sd">    Actually a load where the destination is PC+/-</span>
<span class="sd">    01 110 LLL</span>
<span class="sd">RETURN - Set the program counter to the value pointed at by the stack pointer, then increment the stack pointer</span>
<span class="sd">    Actually a POP into the PC which is actually a load from [SP+/-] to PC</span>
<span class="sd">    10 101 110</span>
<span class="sd">PROGRAM_LOAD - Load the contents of program memory at PPP into the D register. PPP has the same meaning as SSS/DDD</span>
<span class="sd">    01 111 PPP</span>
<span class="sd">PROGRAM_STORE - Store the D register into program memory at PPP</span>
<span class="sd">    10 PPP 110</span>
<span class="sd">NOOP - Do nothing</span>
<span class="sd">    00 000 000</span>
<span class="sd">HALT - Halt the computer</span>
<span class="sd">    00 111 111</span>

<span class="sd">Opcode Gaps</span>
<span class="sd">===========</span>
<span class="sd">Copying a register to itelf is meaningless</span>
<span class="sd">00 000 000 - NOOP</span>
<span class="sd">00 001 001</span>
<span class="sd">00 010 010</span>
<span class="sd">00 011 011</span>
<span class="sd">00 100 100</span>
<span class="sd">00 101 101</span>
<span class="sd">00 110 110</span>
<span class="sd">00 111 111 - HALT</span>

<span class="sd">A copy to or from SP+/- doesn&#39;t make sense, it only has a meaning when doing load or stores</span>
<span class="sd">00 110 XXX - Used by conditional check and jump</span>
<span class="sd">00 XXX 110</span>

<span class="sd">A copy to an immediate value doesnt make sense, you can&#39;t write to an immediate value</span>
<span class="sd">00 111 XXX - Used by conditional test, check and jump</span>

<span class="sd">Loading into SP+/- doesn&#39;t make sense, do you want to increment or decrement?</span>
<span class="sd">01 110 XXX - Used by CALL</span>

<span class="sd">Loading into an immediate doeasn&#39;t make sense, you cant write to immediate values</span>
<span class="sd">01 111 XXX - Used by PROGRAM_LOAD</span>

<span class="sd">Storing SP+/- isn&#39;t very useful</span>
<span class="sd">10 XXX 110 - Used by PROGRAM_STORE</span>


<span class="sd">Call microcode steps</span>
<span class="sd">store pc into mem at sp</span>
<span class="sd">sp -&gt; alu - 1</span>
<span class="sd">alu -&gt; sp</span>
<span class="sd">constant -&gt; pc</span>





<span class="sd">SET_ZERO</span>

<span class="sd">INCR</span>

<span class="sd">DECR</span>

<span class="sd">ADD</span>

<span class="sd">ADD_WITH_CARRY</span>

<span class="sd">SUBTRACT</span>

<span class="sd">SUBTRACT_WITH_BORROW</span>

<span class="sd">AND</span>

<span class="sd">OR</span>

<span class="sd">NAND</span>

<span class="sd">XOR</span>

<span class="sd">NOT</span>

<span class="sd">SHIFT_LEFT</span>

<span class="sd">SHIFT_LEFT_WITH_CARRY</span>

<span class="sd">CHECK_IF_ZERO</span>

<span class="sd">CHECK_IF_EQUAL</span>

<span class="sd">CHECK_IF_CARRY</span>

<span class="sd">CHECK_IF_BORROW</span>

<span class="sd">CHECK_IF_GREATER_THAN</span>

<span class="sd">CHECK_IF_GREATER_THAN_OR_EQUAL</span>

<span class="sd">CHECK_IF_LESS_THAN</span>

<span class="sd">CHECK_IF_LESS_THAN_OR_EQUAL</span>



<span class="sd">Microcode II breakdown</span>
<span class="sd">======================</span>
<span class="sd">32:09</span>
<span class="sd">38:54</span>
<span class="sd">1:06:09</span>

<span class="sd">Call an immediate</span>
<span class="sd">-----------------</span>
<span class="sd">T0: _PCE | _MAW</span>
<span class="sd">T1: _ME | PGM | _IRW | PCC</span>
<span class="sd">T2: _SPE | _ALW | ALS(A_MINUS_B)</span>
<span class="sd">T3: _ALE | _MAW | _SPW | PCC</span>
<span class="sd">T4: _PCE | _MW | _ALW | ALS(A_MINUS_B)</span>
<span class="sd">T5: _ALE | _MAW</span>
<span class="sd">T6: _ME | PGM | _PCW | _TR</span>

<span class="sd">T0: PC -&gt; MAR</span>
<span class="sd">T1: PROGRAM_MEM -&gt; IR, PCC</span>
<span class="sd">T2: SP -&gt; ALU, ALU:SUB1</span>
<span class="sd">T3: ALU -&gt; (MAR, SP), PCC</span>
<span class="sd">T4: PC -&gt; (DATA_MEM, ALU), ALU:SUB1</span>
<span class="sd">T5: ALU -&gt; MAR</span>
<span class="sd">T6: PROGRAM_MEM -&gt; PC, TR</span>

<span class="sd">0  0000 0000 </span>
<span class="sd">1  0000 0001 ---- CALL #6</span>
<span class="sd">2  0000 0010 ---- 0000 0110</span>
<span class="sd">3  0000 0011</span>
<span class="sd">4  0000 0100</span>
<span class="sd">5  0000 0101</span>
<span class="sd">6  0000 0110</span>
<span class="sd">7  0000 0111</span>

<span class="sd">End of T0: SP = 255  PC = 1  MAR = ?    </span>
<span class="sd">End of T1: SP = 255  PC = 2  MAR = ?    </span>
<span class="sd">End of T2: SP = 255  PC = 2  MAR = ?    </span>
<span class="sd">End of T3: SP = 254  PC = 3  MAR = 254  </span>
<span class="sd">End of T4: SP = 254  PC = 3  MAR = 254  D[254] = 3</span>
<span class="sd">End of T5: SP = 254  PC = 3  MAR = 2    D[254] = 3</span>
<span class="sd">End of T6: SP = 254  PC = 6  MAR = 2    D[254] = 3</span>


<span class="sd">Call a register</span>
<span class="sd">---------------</span>
<span class="sd">T0: PC -&gt; MAR</span>
<span class="sd">T1: PROGRAM_MEM -&gt; IR, PCC</span>
<span class="sd">T2: SP -&gt; ALU, ALU:SUB1</span>
<span class="sd">T3: ALU -&gt; (SP, MAR)</span>
<span class="sd">T4: PC -&gt; DATA_MEM</span>
<span class="sd">T5: REG_X -&gt; PC, TR</span>

<span class="sd">0  0000 0000 </span>
<span class="sd">1  0000 0001 ---- CALL REG_X</span>
<span class="sd">2  0000 0010</span>
<span class="sd">3  0000 0011</span>
<span class="sd">4  0000 0100</span>
<span class="sd">5  0000 0101</span>
<span class="sd">6  0000 0110</span>
<span class="sd">7  0000 0111</span>

<span class="sd">End of T0: SP = 255  PC = 1      MAR = ?    </span>
<span class="sd">End of T1: SP = 255  PC = 2      MAR = ?    </span>
<span class="sd">End of T2: SP = 255  PC = 2      MAR = ?    </span>
<span class="sd">End of T3: SP = 254  PC = 2      MAR = 254  </span>
<span class="sd">End of T4: SP = 254  PC = 2      MAR = 254  D[254] = 2</span>
<span class="sd">End of T5: SP = 254  PC = REG_X  MAR = 2    D[254] = 2</span>




<span class="sd">We can&#39;t connect the output of the instruction register directly to the address lines of the EEPROMS.</span>
<span class="sd">This is because it takes time for the EEPROMS to settle after an address change.</span>
<span class="sd">This means that we need to buffer the inputs to the EEPROMS with a &quot;mirror&quot; register that&#39;s clocked on the faling edge of the clock instead.</span>
<span class="sd">It&#39;s the same trick that we use to increment the microcode step on the falling edge.</span>
<span class="sd">https://www.youtube.com/watch?v=ticGSEi0OW4&amp;t=2282s</span>










<span class="sd">&quot;&quot;&quot;</span>





























</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Andy Palmer

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>