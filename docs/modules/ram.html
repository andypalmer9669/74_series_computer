

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>RAM &mdash; Eight Bit Computer  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Control Unit" href="control_unit.html" />
    <link rel="prev" title="Clock" href="clock.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Eight Bit Computer
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Modules</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="register.html">Register</a></li>
<li class="toctree-l2"><a class="reference internal" href="two_to_one.html">2:1 Selector</a></li>
<li class="toctree-l2"><a class="reference internal" href="program_counter.html">Program Counter</a></li>
<li class="toctree-l2"><a class="reference internal" href="clock.html">Clock</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">RAM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#interface-and-operation">Interface and Operation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implementation">Implementation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#combined-input-output-pins">Combined Input/Output pins</a></li>
<li class="toctree-l4"><a class="reference internal" href="#timing-for-safely-writing-data">Timing for Safely Writing Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-setup-mode">Run/Setup Mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hardware">Hardware</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="control_unit.html">Control Unit</a></li>
<li class="toctree-l2"><a class="reference internal" href="alu.html">Arithmetic Logic Unit</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../language/index.html">Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hardware/index.html">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/index.html">Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development_tools.html">Development Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits.html">Credits</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Eight Bit Computer</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Modules</a> &raquo;</li>
        
      <li>RAM</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/modules/ram.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ram">
<h1>RAM<a class="headerlink" href="#ram" title="Permalink to this headline">¶</a></h1>
<p>The RAM provides 256 bytes of program memory (instruction bytes) and 256 bytes
of data memory (global variables and the stack).</p>
<div class="section" id="interface-and-operation">
<h2>Interface and Operation<a class="headerlink" href="#interface-and-operation" title="Permalink to this headline">¶</a></h2>
<p>This is the interface of the RAM:</p>
<img alt="../_images/ram_block.png" src="../_images/ram_block.png" />
<p>This is how it operates:</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="7%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Bit width</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>input_enable</td>
<td>1</td>
<td>While high, the data on data_in will be stored at the currently selected address on a rising clock edge.</td>
</tr>
<tr class="row-odd"><td>output_enable</td>
<td>1</td>
<td>While high, the RAM asserts the data at the currently selected address onto data_out.</td>
</tr>
<tr class="row-even"><td>data_clock</td>
<td>1</td>
<td>Clock signal from the clock module (data_clock).</td>
</tr>
<tr class="row-odd"><td>setup_clock</td>
<td>1</td>
<td>Clock signal from the manual setup switch.</td>
</tr>
<tr class="row-even"><td>run_setup</td>
<td>1</td>
<td>When low, the RAM is in setup mode, when high, run mode.</td>
</tr>
<tr class="row-odd"><td>control_unit_select_data_memory</td>
<td>1</td>
<td>Program/data memory selection switch from the control unit.</td>
</tr>
<tr class="row-even"><td>setup_select_data_memory</td>
<td>1</td>
<td>Program/data memory selection switch from the manual setup switch.</td>
</tr>
<tr class="row-odd"><td>data_in</td>
<td>8</td>
<td>Data to be stored is read from here.</td>
</tr>
<tr class="row-even"><td>data_out</td>
<td>8</td>
<td>Data at current address is output here.</td>
</tr>
<tr class="row-odd"><td>address</td>
<td>8</td>
<td>Index in memory to read from or write to.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="combined-input-output-pins">
<h3>Combined Input/Output pins<a class="headerlink" href="#combined-input-output-pins" title="Permalink to this headline">¶</a></h3>
<p>Unlike the <a class="reference external" href="https://www.youtube.com/watch?v=FnxPIZR1ybs&amp;t=614">74LS189 chip</a> that <a class="reference internal" href="../credits.html#ben-eater"><span class="std std-ref">Ben Eater</span></a> uses for his RAM, the 6116SA
used in this computer has combined input and output pins. This means that care
is required not to apply signals to those pins at incorrect times. A tri state
buffer is used on the input to achieve this. The connections from the
input/output pins on the RAM chip and the 74HCT245 tri state buffers are
arranged like this:</p>
<img alt="../_images/input_output_buffers.png" src="../_images/input_output_buffers.png" />
</div>
<div class="section" id="timing-for-safely-writing-data">
<h3>Timing for Safely Writing Data<a class="headerlink" href="#timing-for-safely-writing-data" title="Permalink to this headline">¶</a></h3>
<p>Most of the time the RAM chip is in read mode. This means that the chip is
asserting the data stored in the address currently specified on the address pins
to the input/output pins. When it’s time to write, the chip needs to switch to
write mode. To simplify control circuitry, only the write enable (active low)
input on the 6116SA is used to control switching between read and write mode
(output enable (active low) is available on the chip as well).</p>
<p>It takes time for the chip to switch modes and the pins to change from output to
input. This time is referred to as tWHZ in the data-sheet and the following note
applies:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ol class="last arabic simple" start="4">
<li>During this period, the I/O pins are in the output state and the
input signals must not be applied.</li>
</ol>
</div>
<p>According to the data-sheet tWHZ is at most 7ns for the 6116SA15 being used.</p>
<p>As well as the time taken for the pins to change state, we need to ensure that
the overall write pulse width is a certain length due to another note in the
data-sheet (which applies because _OE will indeed be low):</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ol class="last arabic simple" start="7">
<li>_OE is continuously HIGH. If _OE is LOW during a _WE controlled
write cycle, the write pulse width must be the larger of tWP or
(tWHZ + tDW) to allow the I/O drivers to turn off and data to be
placed on the bus for the required tDW. If _OE is HIGH during a
_WE controlled write cycle, this requirement does not apply and
the write pulse is the specified tWP. For a _CS controlled write
cycle, _OE may be LOW with no degradation to tCW.</li>
</ol>
</div>
<p>tWP is listed as 12ns, but tWHZ + tDW (7ns + 12ns) is greater at 19ns so the
write pulse needs to be at least that long.</p>
<p>The chip is also not edge triggered - it will write data to the specified
address as long as it is in write mode. This means that we need to do our own
edge detection and keep the write pulse as short as possible. See the
<a class="reference internal" href="../hardware/edge_detection.html#edge-detection"><span class="std std-ref">Edge Detection</span></a> section for more details.</p>
<p>Once the write is finished, the chip can go instantly back into read mode (as
tDH is 0ns).</p>
<p>So with all this in mind, this is how the desired control signals would look
(assuming a write is to take place).</p>
<img alt="../_images/ideal_ram_write_control.png" src="../_images/ideal_ram_write_control.png" />
<p>The output enable on the 74HCT245 and write enable on the 6116SA
are active low so the final circuit looks like this:</p>
<img alt="../_images/write_signal_timing.png" src="../_images/write_signal_timing.png" />
<p>(This can be seen in <a class="reference internal" href="../development_tools.html#falstad"><span class="std std-ref">Falstad Circuit Simulator</span></a> by loading the
<a class="reference download internal" download="" href="../_downloads/7e4658131f24786562b84ed8b2c76c36/ram_write_signal.txt"><code class="xref download docutils literal notranslate"><span class="pre">saved</span> <span class="pre">session</span></code></a>)</p>
<p>From left to right:</p>
<ul class="simple">
<li>The capacitor, resistor and inverting Schmitt trigger on the bottom
form the edge detector that produces a low pulse when a rising edge is
detected.</li>
<li>The three inverting Schmitt triggers on top serve to delay and invert the
clock signal (using propagation delay).</li>
<li>The two OR gates ensure that once the low pulse from the detected
rising edge finishes, both control signals go high at the same time.</li>
</ul>
<p>The propagation delay of the inverting Schmitt triggers (inside a 74HCT14) is
approximately 20ns, to a maximum of approximately 40ns. With the 3 Schmitt
triggers on top, the inversion of the now positive clock is delayed between 60ns
and 120ns.</p>
<p>The resistor and capacitor values are chosen so that the time from the voltage
between the capacitor and the resistor going high, to the voltage going below
the negative going threshold of the Schmitt trigger is at least 112ns. That is:</p>
<ul class="simple">
<li>120ns for the longest possible delay for the top three Schmitt triggers.</li>
<li>Subtract 20ns for the shortest propagation delay from the edge detect Schmitt
trigger.</li>
<li>12ns to satisfy tDW</li>
</ul>
<p>The 7ns required for tWHZ is amply catered for by the chained Schmitt triggers.</p>
<p>The final control signals look like this:</p>
<a class="reference internal image-reference" href="../_images/ram_write_signals.png"><img alt="../_images/ram_write_signals.png" src="../_images/ram_write_signals.png" style="width: 100%;" /></a>
</div>
<div class="section" id="run-setup-mode">
<h3>Run/Setup Mode<a class="headerlink" href="#run-setup-mode" title="Permalink to this headline">¶</a></h3>
<p>The RAM needs to accessed by the computer while running (run mode) and by the
user during setup (setup mode). To achieve this, the follwing inputs to the RAM
all need to be driven by either the computer itself, or the user:</p>
<blockquote>
<div><ul class="simple">
<li>data_in</li>
<li>address</li>
<li>input_enable</li>
<li>select_data_memory</li>
<li>clock</li>
</ul>
</div></blockquote>
<p>The run_setup switch decides which input will be fed to the RAM.</p>
<p>data_in and address are connected to <a class="reference internal" href="two_to_one.html#two-to-one"><span class="std std-ref">2:1 Selector</span></a>s.</p>
<p>The remaining input_enable, prog_data_mem_select and clock are all
connected to a 74HCT157 Quad 2 to 1 line data selector. They are set up as
follows:</p>
<a class="reference internal image-reference" href="../_images/run_setup_mode.png"><img alt="../_images/run_setup_mode.png" src="../_images/run_setup_mode.png" style="width: 100%;" /></a>
<p>From left to right:</p>
<blockquote>
<div><ul class="simple">
<li>Multiplexers to select between run and setup control signals</li>
<li><a class="reference internal" href="../hardware/safe_clock_enable.html#safe-clock-enable"><span class="std std-ref">Safe Clock Enable</span></a></li>
<li>Outputs to the rest of the RAM.</li>
</ul>
</div></blockquote>
<p>When in run mode:</p>
<blockquote>
<div><ul class="simple">
<li>data_in - connected to the bus.</li>
<li>address - connected to the output of the memory address register.</li>
<li>input_enable - connected to ram_in from the <a class="reference internal" href="control_unit.html#control-unit"><span class="std std-ref">Control Unit</span></a>.</li>
<li>select_data_memory - connected to ram_sel_data_mem from the <a class="reference internal" href="control_unit.html#control-unit"><span class="std std-ref">Control Unit</span></a>.</li>
<li>clock - connected to data_clock from the <a class="reference internal" href="clock.html#clock-module"><span class="std std-ref">Clock</span></a>.</li>
</ul>
</div></blockquote>
<p>When in setup mode, all of the above are connected to switches that the user
controls, apart from input_enable which is held high.</p>
</div>
<div class="section" id="hardware">
<h3>Hardware<a class="headerlink" href="#hardware" title="Permalink to this headline">¶</a></h3>
<p>The following electronics are used:</p>
<blockquote>
<div><ul class="simple">
<li>A 6166SA15 RAM chip to hold all the data.</li>
<li>2 x 74HCT245 for controlling input and output to and from the RAMs IO pins.</li>
<li>A 74HCT157 to choose between the inputs in run and setup mode.</li>
<li>A 74HCT02 containing NOR gates to build the <a class="reference internal" href="../hardware/safe_clock_enable.html#safe-clock-enable"><span class="std std-ref">Safe Clock Enable</span></a>.</li>
<li>A 74HCT08 containing AND gates to build the <a class="reference internal" href="../hardware/safe_clock_enable.html#safe-clock-enable"><span class="std std-ref">Safe Clock Enable</span></a> and
isolate the resistor and capacitor circuit from the other logic gates.</li>
<li>A 74HCT14 containing Schmitt triggers to edge detect and delay the clock.</li>
<li>A 74HCT32 for the OR gates that are used in the edge detection and delay
circuit.</li>
</ul>
</div></blockquote>
<p>They are laid out on the breadboards as follows:</p>
<a class="reference internal image-reference" href="../_images/ram_bb.png"><img alt="../_images/ram_bb.png" src="../_images/ram_bb.png" style="width: 100%;" /></a>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="control_unit.html" class="btn btn-neutral float-right" title="Control Unit" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="clock.html" class="btn btn-neutral float-left" title="Clock" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Andy Palmer

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>